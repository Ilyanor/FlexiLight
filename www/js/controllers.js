// angular.module('controllers', [])

// var app=angular.module('module.controllers',[]);

//Creating the module which will be referenced in "app.js" with a specific controller named Maincontroller

app.controller('MainController', function ($scope, $timeout,$interval) {

	$scope.test = "Voyons voir";

	$scope.currentData = {};
	// $scope.arrayLength=datas.length;
	$scope.datas = [
		{
			time: 1,
			hR: 85,
			rR: 12,
			sa02: 96
		},
		{
			time:2,
			hR:97,
			rR:14,
			sa02:99
		},
		{
			time:3,
			hR:94,
			rR:14,
			sa02:95
		},
		{
			time: 4,
			hR: 75,
			rR:19,
			sa02:99
		}
	];



	$scope.test2="test suivant";

	$scope.simulateRead = function () {
		while (1) {
			$scope.$interval(function () {
				var DataSample = {
					time: Math.random() * 10,
					hR: Math.random() * 100,
					rR: Math.random() * 100,
					sa02: Math.random() * 100
				};
				$scope.datas.push(DataSample);
			}, 2000);
		}
	};

	$scope.simulateReadAfterTwoSecs = function () {
		$timeout(function () {
			var DataSample = {
				time: Math.random() * 10,
				hR: Math.random() * 100,
				rR: Math.random() * 100,
				sa02: Math.random() * 100
			};
			$scope.datas.push(DataSample);
		}, 1000);
		$scope.currentData = DataSample;
	};

	$scope.addSampleData = function () {
		var DataSample = {
			time: Math.floor((Math.random() * 10) + 1),
			hR: Math.floor((Math.random() * 50) + 40),
			rR: Math.floor((Math.random() * 15) + 10),
			sa02: Math.floor((Math.random() * 10) + 90)
		};
		$scope.datas.push(DataSample);
		$scope.currentData = DataSample;
		console.log($scope.datas.length);
		$scope.testLengthDataSample=$scope.datas.length;

	};



	$scope.randomDataContinuously=function(){
		function addSampleDataTest(){
			var DataSample = { //We generate random values
				time: Math.floor((Math.random() * 10) + 1), // transform it to something better ie integrate in for loopg
				hR: Math.floor((Math.random() * 50) + 40),
				rR: Math.floor((Math.random() * 15) + 10),
				sa02: Math.floor((Math.random() * 10) + 90)
			};
			$scope.datas.push(DataSample); //we push into the array "datasample"
			$scope.currentData = DataSample;
			// console.log($scope.datas.length); // display the length, allow to show if the array is correctly expanding
			$scope.testLengthDataSample=$scope.datas.length;
		};
		$interval(addSampleDataTest,1000); // we repeat this function each second.
	};

	$scope.arrayTransformation = function() {
		//1 Convert the array of objects in an array of arrays
		var outputData = $scope.datas.map( Object.values );
		// 2 Remove the last value generated by the previous function which was like 'object:769'
		// for(i=0; i<$scope.datas.length;i++){
		// 	outputData[i].pop();
		// };
		console.log(outputData);
		// 3 Transpose this array of arrays to go from N arrays with 4 values to 4 arrays with N values
		var arraysTransposed = 	transposeArrays(outputData);
		var timeChart = arraysTransposed[0];
		arraysTransposed.shift();
		 console.log(arraysTransposed);
	};

	// dataEx.setValueCharts("arraysTransposed");
	$scope.labels = ["January", "February", "March", "April", "May", "June", "July"];
	$scope.series = ['Series A', 'Series B'];
	$scope.dataz = [
		[65, 59, 80, 81, 56, 55, 40],
		[28, 48, 40, 19, 86, 27, 90]
	];

	console.log(angular.version);

	$scope.labelsTest = [1,2,3,4,5,6,7,8,9,10];
	$scope.seriesTest = ['HR', 'RR','Sa02'];
	 $scope.datasTest = [[85,78,56,69,71,75,83,89,95],[12,13,12,14,12,14,15,14,15,14],[98,98,97,96,95,94,94,93,96,98]];

console.log($scope.datas);
console.log($scope.datasTest);


	$scope.onClick = function (points, evt) {
		console.log(points, evt);
	};

	$scope.datasetOverride = [{ yAxisID: 'y-axis-1' }, { yAxisID: 'y-axis-2' }];
	$scope.options = {
		scales: {
			yAxes: [
				{
					id: 'y-axis-1',
					type: 'linear',
					display: true,
					position: 'left'
				},
				{
					id: 'y-axis-2',
					type: 'linear',
					display: true,
					position: 'right'
				}
			]
		}
	};



});

function transposeArrays(a)
{
	return a[0].map(function (_, c) { return a.map(function (r) { return r[c]; }); });
};
